---
title: "Data Gathering"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
library(tidycensus)
library(leaflet)
library(lubridate)
```

Datasets
```{r}
acled_data <- read_xlsx("raw_data/USA_2020_Oct31_new.xlsx") %>%
  clean_names()
```

Violence
```{r}
violence <- acled_data %>%
  select(sub_event_type) %>%
  mutate(sub_event_type = as.factor(sub_event_type)) %>%
  filter(sub_event_type == c("Peaceful protest", "Protest with intervention",
                            "Excessive force against protesters",
                            "Violent demonstration",
                            "Mob violence")) %>%
  group_by(sub_event_type) %>%
  summarize(count = n())

violence_BLM <- acled_data %>%
  filter(assoc_actor_1 == "BLM: Black Lives Matter") %>%
  select(sub_event_type) %>%
  mutate(sub_event_type = as.factor(sub_event_type)) %>%
  filter(sub_event_type == c("Peaceful protest", "Protest with intervention",
                            "Excessive force against protesters",
                            "Violent demonstration",
                            "Mob violence")) %>%
  group_by(sub_event_type) %>%
  summarize(count = n(), .groups = "drop")

comparison <- inner_join(violence, violence_BLM, by = "sub_event_type") %>%
  rename(all = count.x,
         blm = count.y) %>%
  pivot_longer(cols = all:blm,
               names_to = "type",
               values_to = "count")

ggplot(comparison, aes(x = reorder(sub_event_type, count), 
                       y = count, fill = type)) +
    geom_col(position = "identity") + 
    labs(title = "Violence at Protests",
         subtitle = "Summer and Fall 2020",
         x = "Type of Protest",
         y = "Number of Protests") + 
    coord_flip() + 
    scale_color_manual(breaks = c("all", "blm"),
                       labels = c("All Protests", "BLM")) + 
    theme_classic()

fatalities <- acled_data %>%
  filter(fatalities > 0)
  
```

Mapping
```{r}
census_api_key("c272499f01a005c075c74055db3526e316e1836d")

rural <- get_decennial(geography = "state",
                       variables = c("P001001", "P002005"),
                       year = 2010,
                       output = "wide",
                       geometry = TRUE) %>%
  rename(state = NAME) %>%
  mutate(prop_rural = P002005/P001001,
         state = reorder(state, prop_rural))

subset <- acled_data %>%
  mutate(event_date = ymd(event_date)) %>%
  filter(event_date <= "2020-06-01")

leaflet(rural) %>%
  addTiles() %>%
  addCircles(lng = subset$longitude, lat = subset$latitude)

```

